AWSTemplateFormatVersion: 2010-09-09
Resources:
    DeployIAMUser:
      Type: AWS::IAM::User
      Properties:
        Path: /
        UserName: cli-lambda-deploy
        Policies:
        - PolicyName: LambdaDeploy
          PolicyDocument:
            Version: 2012-10-17
            Statement:
               - Effect: Allow
                 # Sid: uploadFunctiononTestFunctions
                 Action:
                   - 'lambda:UploadFunction'
                 Resource:
                    - '*'
                    # - '*'
    DeployIAMKey:
      Type: AWS::IAM::AccessKey
      Properties:
        UserName:
          !Ref DeployIAMUser


    TestRole:
        Type: AWS::IAM::Role
        Properties:
          AssumeRolePolicyDocument:
            Version: '2012-10-17'
            Statement:
            - Effect: Allow
              Principal: {Service: [lambda.amazonaws.com]}
              Action: ['sts:AssumeRole']
          Path: /
          ManagedPolicyArns:
          - "arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"


Outputs:
    AccessKeyId:
        Value: !Ref DeployIAMKey
        Export:
            Name: AccessKeyId
    SecretAccessKey:
        Value: !GetAtt DeployIAMKey.SecretAccessKey
        Export:
            Name: SecretAccessKey
    RoleArn:
        Value: !GetAtt TestRole.Arn
        Export:
            Name: RoleArn
